# プロダクトコンテキスト - RosterHub

## 概要
本ドキュメントは、RosterHubのビジネスコンテキスト、プロダクト目的、コア機能を定義します。AIエージェントが開発判断の「なぜ」を理解し、ビジネス目標との整合性を確保するためのガイドです。

**最終更新日**: 2025-11-15 (Steering Agent - Sprint 5 セキュリティ実装完了)

---

## プロダクトビジョン

### 構築するもの
**RosterHub**は、**OneRoster Japan Profile 1.2.2準拠の統合ハブ**であり、校務支援システムと学習ツール間の教育データ連携を標準化・自動化します。教育委員会レベルの展開を想定し、10,000〜200,000名規模の複数学校を管理する組織向けに設計されています。

### 解決する課題
教育機関が現在抱える課題:
- **手動CSV運用**: システム間でのCSVエクスポート/インポートに時間がかかる
- **データ連携の混乱**: 非標準フォーマットにより、ベンダーごとにカスタム統合が必要
- **同期エラー**: 手動データ更新によるシステム間の不整合
- **セキュリティリスク**: メールやファイル共有サービスによるCSVファイル送信
- **コンプライアンス課題**: 個人情報保護規制への対応困難
- **スケーラビリティの問題**: 手動プロセスは10万名以上の組織に対応できない

### ターゲットユーザー

**主要ユーザー**: 教育委員会（都道府県・市区町村レベル）
- **組織規模**: 10,000〜200,000名の生徒・教職員を管理
- **ユーザー数**: 10〜100名のシステム管理者・連携担当者
- **利用ケース**: 校務支援システムと複数の学習プラットフォームを接続する中央データハブ
- **技術レベル**: 中級（システム管理者、IT担当者）

**副次ユーザー**: 学校・教育機関
- **組織規模**: 500〜5,000名の生徒を持つ個別学校
- **利用ケース**: 校務支援システムとの直接統合
- **技術レベル**: 初級〜中級

**第三ユーザー**: ベンダー・学習プラットフォーム提供者
- **利用ケース**: REST API経由でOneRoster準拠データを取得
- **技術レベル**: 上級（開発者・統合チーム）

---

## コア機能

### 必須機能（MVP）

#### 1. OneRoster Japan Profile 1.2.2 CSV インポート
- **ユーザー価値**: 校務支援システムからの一括データインポート（100MB+ファイル、200,000名以上）
- **優先度**: 最重要
- **説明**: ストリーミングCSVパーサーで全Japan Profileエンティティに対応、検証機能とバックグラウンド処理（30分非同期ジョブ）

#### 2. OneRoster Japan Profile 1.2.2 CSV エクスポート
- **ユーザー価値**: CSVインポート対応学習ツール向け標準データエクスポート
- **優先度**: 最重要
- **説明**: Japan Profile準拠CSVファイル生成、適切なエンコーディング（UTF-8 BOM）、メタデータフィールド、一括ダウンロード

#### 3. OneRoster REST API（一括アクセス）
- **ユーザー価値**: 学習プラットフォーム向けリアルタイムデータアクセス
- **優先度**: 最重要
- **説明**: 全OneRosterエンティティのCRUD操作、ページネーション、フィルタリング、ソート機能

#### 4. OneRoster Delta/Incremental API（差分取得API）
- **ユーザー価値**: 前回同期以降の変更データのみ取得することで効率的同期
- **優先度**: 高
- **説明**: `dateLastModified`クエリによるタイムスタンプベースの変更追跡、論理削除サポート（`status='tobedeleted'`）

#### 5. データ検証とエラーハンドリング
- **ユーザー価値**: 不正データの侵入防止、明確なエラーレポート提供
- **優先度**: 最重要
- **説明**: Japan Profileフィールド検証、参照整合性チェック、重複検出、詳細エラーレポート

#### 6. API認証とセキュリティ
- **ユーザー価値**: 詳細な権限制御による安全なAPIアクセス
- **優先度**: 最重要
- **説明**: API Key認証とIPホワイトリスト制限、レート制限、監査ログ

### 高優先度機能（フェーズ2）

- **Webベース CSV インポート UI**: ブラウザベースのアップロードと進捗追跡
- **データマッピング設定**: 非標準ソースシステム向けカスタムフィールドマッピング
- **高度な監視ダッシュボード**: リアルタイム同期ステータス、エラー分析、監査証跡可視化
- **Webhook通知**: データ変更のイベント駆動通知
- **マルチテナントサポート**: 複数教育委員会クライアント向け環境分離

### 将来的機能（今後のフェーズ）

- **リアルタイムデータストリーミング**: WebSocketベースのリアルタイム更新
- **データ品質レポート**: 自動データ品質チェックと推奨事項
- **多言語サポート**: UI・ドキュメントの英語・日本語・その他言語対応
- **高度な分析**: 利用状況分析、同期パフォーマンス指標、トレンド分析
- **カスタムエンティティ拡張**: Japan Profileを超えたベンダー固有拡張のサポート

### 明示的に対象外の項目

- **OneRoster 1.1以前のバージョン**（1.2.2 Japan Profileのみサポート）
- **カスタムデータフォーマット**（OneRoster以外の標準）
- **データベース直接統合**（外部アクセスはAPIのみ）
- **学習管理システム機能**（LMS/LTI機能）
- **学校情報システム機能**（RosterHubは統合のみ）
- **リアルタイムチャットやコラボレーション**（コミュニケーションプラットフォームではない）

---

## ビジネスモデル

### 収益モデル
- **サブスクリプション型SaaS**（組織単位またはユーザー単位）
- **段階的価格設定**:
  - **スターター**: 最大10,000名 - 基本CSV インポート/エクスポート + REST API
  - **プロフェッショナル**: 最大50,000名 - Delta APIを含む全機能
  - **エンタープライズ**: 50,000名以上 - カスタムSLA、専任サポート、オンプレミス展開オプション
- **年間契約**（ボリュームディスカウント）

### 主要指標
追跡する成功指標:
- **データ精度率**: 検証エラーなしの成功インポート率（目標: 99%以上）
- **API稼働率**: システム可用性（目標: 99.9%）
- **同期パフォーマンス**: 100,000名のCSVインポート平均時間（目標: 30分未満）
- **顧客維持率**: 年間更新率（目標: 95%以上）
- **統合ボリューム**: 顧客あたりアクティブ学習ツール統合数
- **エラー解決時間**: エラー検出から解決までの時間（目標: 重大問題は1時間未満）

---

---

## Sprint 5 実装状況（完了 ✅）

### セキュリティ機能実装
- ✅ **APIキー管理**: 生成、検証、失効機能
  - 暗号学的に安全なキー生成（256ビットエントロピー）
  - Bcryptハッシュ化（12ラウンドsalt）で安全に保存
  - Redis キャッシュ（5分TTL）でパフォーマンス向上
- ✅ **IPホワイトリストガード**: IPv4/IPv6/CIDR対応
- ✅ **レート制限ガード**: トークンバケット + スライディングウィンドウアルゴリズム
  - デフォルト: APIキーごとに1時間1000リクエスト（設定可能）
- ✅ **強化された監査ログ**: データベース + コンソール、GDPR準拠
  - リクエスト/レスポンスキャプチャ、データサニタイゼーション
  - エンティティコンテキスト抽出（タイプ、アクション、sourcedId）

### 実装統計
- 新規ファイル: 14ファイル（約3,257行）
- テストファイル: 2ファイル（約661行）
- ユニットテスト: 26テスト

### 全体進捗
- **完了**: 76/104タスク（73%）
- **次回**: Sprint 6（CSV処理）、Sprint 7-8（高度なAPI機能）

---

**注記**: 本ドキュメントはプロダクトの方向性の変化に応じて更新してください。詳細仕様ではなく、高レベルのコンテキストに焦点を当ててください（詳細仕様は要件・設計ドキュメントに記載）。

**最終更新日**: 2025-11-15 (Steering Agent - Sprint 5 セキュリティ実装完了)
