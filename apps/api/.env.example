##############################################################################
# RosterHub API - Environment Configuration
#
# This file contains all environment variables used by the RosterHub API.
# Copy this file to .env and configure the values for your environment.
#
# Usage:
#   cp .env.example .env
#   nano .env  # Edit with your configuration
#
# Security Notes:
#   - NEVER commit .env to git (.env is in .gitignore)
#   - Use strong, randomly generated secrets
#   - Different configurations for dev/staging/production
#   - Encrypt .env in production (use dotenv-vault or AWS Secrets Manager)
#
# Last Updated: 2025-11-16
##############################################################################

#-----------------------------------------------------------------------------
# Application Configuration
#-----------------------------------------------------------------------------

# Node environment (development, test, staging, production)
# Controls logging verbosity, error handling, and performance optimizations
# Required: Yes
# Default: development
# Valid values: development | test | staging | production
NODE_ENV=development

# API server port
# Required: Yes
# Default: 3000
# Valid values: 1024-65535
API_PORT=3000

# API base path (for reverse proxy deployments)
# Required: No
# Default: /
# Example: /api/v1
API_BASE_PATH=/

# Application log level
# Required: No
# Default: info (production) | debug (development)
# Valid values: error | warn | info | debug | verbose
LOG_LEVEL=info

#-----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
#-----------------------------------------------------------------------------

# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database?schema=public
# Required: Yes
# Security: Use strong password, enable SSL in production
# Example: postgresql://rosterhub:secret123@localhost:5432/rosterhub?schema=public
DATABASE_URL=postgresql://rosterhub:password@localhost:5432/rosterhub?schema=public

# Database connection pool size
# Required: No
# Default: 10
# Valid values: 1-100
# Recommendation: 20 for production
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=20

# Database connection timeout (milliseconds)
# Required: No
# Default: 10000 (10 seconds)
DATABASE_TIMEOUT=10000

# Enable SSL for database connections (production)
# Required: No (Yes for production)
# Default: false
# Valid values: true | false
DATABASE_SSL=false

# Database SSL certificate path (if DATABASE_SSL=true)
# Required: No (Yes if DATABASE_SSL=true)
# Example: /etc/ssl/certs/postgres.crt
# DATABASE_SSL_CERT=/path/to/postgres.crt

#-----------------------------------------------------------------------------
# Redis Configuration (Caching & Queue)
#-----------------------------------------------------------------------------

# Redis server hostname
# Required: Yes
# Example: localhost | redis.example.com
REDIS_HOST=localhost

# Redis server port
# Required: Yes
# Default: 6379
REDIS_PORT=6379

# Redis password (required for production)
# Required: No (Yes for production)
# Security: Use strong random password
# Example: Generated with: openssl rand -base64 32
REDIS_PASSWORD=

# Redis database index (0-15)
# Required: No
# Default: 0
# Recommendation: Use different indexes for dev/staging/production
REDIS_DB=0

# Redis connection timeout (milliseconds)
# Required: No
# Default: 5000 (5 seconds)
REDIS_TIMEOUT=5000

# Redis key TTL for API key cache (seconds)
# Required: No
# Default: 300 (5 minutes)
REDIS_API_KEY_TTL=300

# Enable Redis TLS/SSL (production)
# Required: No (Yes for production)
# Default: false
REDIS_TLS=false

#-----------------------------------------------------------------------------
# Authentication & Security
#-----------------------------------------------------------------------------

# JWT secret for token signing
# Required: Yes
# Security: CRITICAL - Use strong random secret (min 32 characters)
# Generate with: openssl rand -base64 32 | tr -d '\n'
# WARNING: Changing this invalidates all existing tokens
JWT_SECRET=REPLACE_WITH_STRONG_SECRET

# JWT token expiration time
# Required: No
# Default: 1h
# Valid values: 15m | 1h | 24h | 7d
# Recommendation: 1h for API tokens, 15m for admin tokens
JWT_EXPIRATION=1h

# Enable API key authentication
# Required: No
# Default: true
# Valid values: true | false
# WARNING: Never disable in production
API_KEY_ENABLED=true

# Default rate limit (requests per hour)
# Required: No
# Default: 1000
# Valid values: 100-999999
# Recommendation: 1000 for general API keys, 10000 for premium
RATE_LIMIT_DEFAULT=1000

# Enable rate limiting
# Required: No
# Default: true
# Valid values: true | false
# WARNING: Never disable in production
RATE_LIMIT_ENABLED=true

# Rate limit window (seconds)
# Required: No
# Default: 3600 (1 hour)
# Valid values: 60-86400
RATE_LIMIT_WINDOW=3600

# Enable IP whitelisting
# Required: No
# Default: false
# Valid values: true | false
IP_WHITELIST_ENABLED=false

# Whitelisted IP addresses (comma-separated)
# Required: No (Yes if IP_WHITELIST_ENABLED=true)
# Format: IP1,IP2,IP3 or CIDR notation
# Example: 192.168.1.100,10.0.0.0/24,203.0.113.5
# IP_WHITELIST=

#-----------------------------------------------------------------------------
# CORS Configuration
#-----------------------------------------------------------------------------

# Enable CORS
# Required: No
# Default: true
# Valid values: true | false
CORS_ENABLED=true

# Allowed origins (comma-separated)
# Required: No
# Default: * (all origins - NOT recommended for production)
# Example: https://example.com,https://app.example.com
# Recommendation: Restrict to specific domains in production
CORS_ALLOWED_ORIGINS=*

# Allowed HTTP methods
# Required: No
# Default: GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS

# Allow credentials (cookies, authorization headers)
# Required: No
# Default: true
# Valid values: true | false
CORS_ALLOW_CREDENTIALS=true

#-----------------------------------------------------------------------------
# File Upload Configuration
#-----------------------------------------------------------------------------

# Maximum CSV file size (bytes)
# Required: No
# Default: 52428800 (50 MB)
# Valid values: 1048576-524288000 (1 MB - 500 MB)
# Recommendation: 52428800 (50 MB) for 200,000 records
CSV_MAX_FILE_SIZE=52428800

# CSV upload temporary directory
# Required: No
# Default: /tmp
# Recommendation: Use dedicated directory with proper permissions
CSV_TEMP_DIR=/tmp

# CSV batch size for import
# Required: No
# Default: 1000
# Valid values: 100-10000
# Recommendation: 1000 for optimal performance
CSV_BATCH_SIZE=1000

#-----------------------------------------------------------------------------
# Background Jobs (BullMQ)
#-----------------------------------------------------------------------------

# BullMQ job concurrency
# Required: No
# Default: 5
# Valid values: 1-20
# Recommendation: 5 for balanced performance
BULLMQ_CONCURRENCY=5

# BullMQ job timeout (milliseconds)
# Required: No
# Default: 1800000 (30 minutes)
# Valid values: 60000-3600000 (1 minute - 1 hour)
BULLMQ_JOB_TIMEOUT=1800000

# BullMQ job retention (days)
# Required: No
# Default: 7
# Valid values: 1-30
# Recommendation: 7 for completed jobs, 30 for failed jobs
BULLMQ_JOB_RETENTION_COMPLETED=7
BULLMQ_JOB_RETENTION_FAILED=30

# Enable BullMQ UI (development only)
# Required: No
# Default: false
# Valid values: true | false
# WARNING: Never enable in production (exposes queue data)
BULLMQ_UI_ENABLED=false

#-----------------------------------------------------------------------------
# Logging & Monitoring
#-----------------------------------------------------------------------------

# Enable audit logging
# Required: No
# Default: true
# Valid values: true | false
# Recommendation: Always enabled in production
AUDIT_LOGGING_ENABLED=true

# Audit log retention (days)
# Required: No
# Default: 90
# Valid values: 30-365
# Recommendation: 90 for general audits, 365 for compliance
AUDIT_LOG_RETENTION_DAYS=90

# Enable performance metrics
# Required: No
# Default: true
# Valid values: true | false
METRICS_ENABLED=true

# Metrics export interval (milliseconds)
# Required: No
# Default: 60000 (1 minute)
# Valid values: 10000-300000 (10 seconds - 5 minutes)
METRICS_INTERVAL=60000

# Sentry DSN for error tracking (optional)
# Required: No
# Example: https://xxx@yyy.ingest.sentry.io/zzz
# Recommendation: Configure for production monitoring
# SENTRY_DSN=

# Sentry environment
# Required: No (Yes if SENTRY_DSN is set)
# Valid values: development | staging | production
# SENTRY_ENVIRONMENT=production

# Sentry sample rate (0.0 - 1.0)
# Required: No
# Default: 1.0 (100% of errors)
# Recommendation: 1.0 for production, 0.1 for high-traffic staging
# SENTRY_SAMPLE_RATE=1.0

#-----------------------------------------------------------------------------
# OneRoster Configuration
#-----------------------------------------------------------------------------

# OneRoster API version
# Required: No
# Default: v1p2
# Valid values: v1p1 | v1p2
ONEROSTER_VERSION=v1p2

# Enable OneRoster Japan Profile extensions
# Required: No
# Default: true
# Valid values: true | false
ONEROSTER_JAPAN_PROFILE_ENABLED=true

# Maximum filter complexity (max number of AND/OR operators)
# Required: No
# Default: 10
# Valid values: 1-50
# Recommendation: 10 to prevent resource exhaustion
ONEROSTER_MAX_FILTER_COMPLEXITY=10

# Maximum pagination limit
# Required: No
# Default: 1000
# Valid values: 100-10000
# Recommendation: 1000 to balance performance and usability
ONEROSTER_MAX_LIMIT=1000

#-----------------------------------------------------------------------------
# Feature Flags (Optional)
#-----------------------------------------------------------------------------

# Enable CSV import feature
# Required: No
# Default: true
# Valid values: true | false
FEATURE_CSV_IMPORT_ENABLED=true

# Enable CSV export feature
# Required: No
# Default: true
# Valid values: true | false
FEATURE_CSV_EXPORT_ENABLED=true

# Enable Delta/Incremental API
# Required: No
# Default: true
# Valid values: true | false
FEATURE_DELTA_API_ENABLED=true

# Enable field selection (fields parameter)
# Required: No
# Default: true
# Valid values: true | false
FEATURE_FIELD_SELECTION_ENABLED=true

#-----------------------------------------------------------------------------
# Development & Testing
#-----------------------------------------------------------------------------

# Enable Swagger/OpenAPI documentation UI
# Required: No
# Default: true (development) | false (production)
# Valid values: true | false
# Recommendation: Disable in production for security
SWAGGER_ENABLED=true

# Swagger UI path
# Required: No
# Default: /api/docs
SWAGGER_PATH=/api/docs

# Enable request/response logging (verbose)
# Required: No
# Default: false
# Valid values: true | false
# WARNING: Logs may contain sensitive data - disable in production
DEBUG_HTTP_LOGGING=false

# Enable database query logging
# Required: No
# Default: false (production) | true (development)
# Valid values: true | false
DATABASE_QUERY_LOGGING=false

# Test database URL (for E2E tests)
# Required: No (Yes for running E2E tests)
# Example: postgresql://rosterhub:password@localhost:5432/rosterhub_test?schema=public
# TEST_DATABASE_URL=

# Mock external services in development
# Required: No
# Default: false
# Valid values: true | false
MOCK_EXTERNAL_SERVICES=false

##############################################################################
# Environment-Specific Configuration Examples
##############################################################################

#-----------------------------------------------------------------------------
# Development Environment
#-----------------------------------------------------------------------------
# NODE_ENV=development
# LOG_LEVEL=debug
# DATABASE_URL=postgresql://rosterhub:dev123@localhost:5432/rosterhub_dev?schema=public
# REDIS_HOST=localhost
# REDIS_PASSWORD=dev_redis_password
# JWT_SECRET=dev_jwt_secret_DO_NOT_USE_IN_PRODUCTION
# SWAGGER_ENABLED=true
# DEBUG_HTTP_LOGGING=true
# DATABASE_QUERY_LOGGING=true

#-----------------------------------------------------------------------------
# Staging Environment
#-----------------------------------------------------------------------------
# NODE_ENV=staging
# LOG_LEVEL=info
# DATABASE_URL=postgresql://rosterhub:staging_pass@db.staging.rosterhub.com:5432/rosterhub?schema=public&sslmode=require
# DATABASE_SSL=true
# REDIS_HOST=redis.staging.rosterhub.com
# REDIS_PASSWORD=staging_redis_strong_password
# REDIS_TLS=true
# JWT_SECRET=staging_jwt_secret_32_chars_min
# SWAGGER_ENABLED=true
# SENTRY_DSN=https://xxx@yyy.ingest.sentry.io/zzz
# SENTRY_ENVIRONMENT=staging

#-----------------------------------------------------------------------------
# Production Environment
#-----------------------------------------------------------------------------
# NODE_ENV=production
# LOG_LEVEL=warn
# DATABASE_URL=postgresql://rosterhub:prod_strong_pass@db.prod.rosterhub.com:5432/rosterhub?schema=public&sslmode=require
# DATABASE_SSL=true
# DATABASE_POOL_MAX=20
# REDIS_HOST=redis.prod.rosterhub.com
# REDIS_PASSWORD=prod_redis_very_strong_password
# REDIS_TLS=true
# JWT_SECRET=prod_jwt_secret_generated_with_openssl_rand
# API_KEY_ENABLED=true
# RATE_LIMIT_ENABLED=true
# IP_WHITELIST_ENABLED=true
# IP_WHITELIST=10.0.0.0/8,172.16.0.0/12
# CORS_ALLOWED_ORIGINS=https://rosterhub.com,https://app.rosterhub.com
# SWAGGER_ENABLED=false
# DEBUG_HTTP_LOGGING=false
# DATABASE_QUERY_LOGGING=false
# SENTRY_DSN=https://xxx@yyy.ingest.sentry.io/zzz
# SENTRY_ENVIRONMENT=production
# AUDIT_LOGGING_ENABLED=true
# AUDIT_LOG_RETENTION_DAYS=365

##############################################################################
# Security Checklist
##############################################################################
#
# Before deploying to production, ensure:
#
# ✅ NODE_ENV=production
# ✅ Strong JWT_SECRET (min 32 random characters)
# ✅ Strong REDIS_PASSWORD
# ✅ Strong database password in DATABASE_URL
# ✅ DATABASE_SSL=true and DATABASE_SSL_CERT configured
# ✅ REDIS_TLS=true for production
# ✅ API_KEY_ENABLED=true
# ✅ RATE_LIMIT_ENABLED=true
# ✅ CORS_ALLOWED_ORIGINS restricted to specific domains
# ✅ SWAGGER_ENABLED=false (or restricted to internal IPs)
# ✅ DEBUG_HTTP_LOGGING=false
# ✅ DATABASE_QUERY_LOGGING=false
# ✅ AUDIT_LOGGING_ENABLED=true
# ✅ SENTRY_DSN configured for error monitoring
# ✅ .env file encrypted (dotenv-vault or AWS Secrets Manager)
# ✅ .env file has restricted permissions (chmod 600)
# ✅ .env file NOT committed to git
# ✅ IP_WHITELIST_ENABLED=true (if applicable)
# ✅ Separate .env files for dev/staging/production
#
##############################################################################
