apiVersion: v1
kind: Secret
metadata:
  name: rosterhub-secret
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "rosterhub.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database Connection
  {{- if .Values.secrets.databaseUrl }}
  database-url: {{ .Values.secrets.databaseUrl | quote }}
  {{- else }}
  database-url: "postgresql://{{ .Values.secrets.postgresUser }}:{{ .Values.secrets.postgresPassword }}@{{ .Values.postgresql.name }}:{{ .Values.postgresql.service.port }}/{{ .Values.secrets.postgresDb }}"
  {{- end }}

  # Redis Connection
  {{- if .Values.secrets.redisUrl }}
  redis-url: {{ .Values.secrets.redisUrl | quote }}
  {{- else }}
  redis-url: "redis://:{{ .Values.secrets.redisPassword }}@{{ .Values.redis.name }}:{{ .Values.redis.service.port }}"
  {{- end }}

  # JWT Configuration
  jwt-secret: {{ .Values.secrets.jwtSecret | quote }}
  jwt-expires-in: {{ .Values.secrets.jwtExpiresIn | quote }}
  jwt-refresh-expires-in: {{ .Values.secrets.jwtRefreshExpiresIn | quote }}

  # Environment Variables
  DATABASE_URL: {{ .Values.secrets.databaseUrl | default (printf "postgresql://%s:%s@%s:%d/%s" .Values.secrets.postgresUser .Values.secrets.postgresPassword .Values.postgresql.name (.Values.postgresql.service.port | int) .Values.secrets.postgresDb) | quote }}
  REDIS_URL: {{ .Values.secrets.redisUrl | default (printf "redis://:%s@%s:%d" .Values.secrets.redisPassword .Values.redis.name (.Values.redis.service.port | int)) | quote }}
  JWT_SECRET: {{ .Values.secrets.jwtSecret | quote }}
  JWT_EXPIRES_IN: {{ .Values.secrets.jwtExpiresIn | quote }}
  JWT_REFRESH_EXPIRES_IN: {{ .Values.secrets.jwtRefreshExpiresIn | quote }}
